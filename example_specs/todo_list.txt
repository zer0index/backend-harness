# Simple Todo List API Specification

## Overview

Build a simple, clean todo list API with basic CRUD operations. Users can create, view, update, and delete todos. Perfect for testing and demonstrations.

## Technology Stack

- **Framework:** FastAPI (Python 3.11+)
- **Database:** PostgreSQL 15+ (via Docker)
- **ORM:** SQLAlchemy 2.0 (async)
- **Migrations:** Alembic
- **Authentication:** Mock authentication (swappable for JWT later)
- **Testing:** pytest + pytest-asyncio + httpx
- **Validation:** Pydantic v2
- **Documentation:** Auto-generated OpenAPI (FastAPI built-in)

## Authentication

**Current Implementation:** Mock authentication
- All requests automatically authenticated
- No Authorization header required during development
- Always returns mock user: `{"id": 1, "name": "Test User"}`

**Future Implementation:** JWT tokens with proper authentication

## Core Resources

### 1. Todos

**Model Fields:**
- `id` (integer, primary key)
- `title` (string, required, max 200 chars)
- `description` (text, optional, max 1000 chars)
- `completed` (boolean, default: false)
- `created_at` (datetime, auto)
- `updated_at` (datetime, auto)

**Endpoints:**
- `GET /api/v1/todos` - List all todos (with pagination and filters)
- `POST /api/v1/todos` - Create new todo
- `GET /api/v1/todos/{id}` - Get todo by ID
- `PUT /api/v1/todos/{id}` - Update todo
- `DELETE /api/v1/todos/{id}` - Delete todo
- `PATCH /api/v1/todos/{id}/complete` - Mark todo as complete
- `PATCH /api/v1/todos/{id}/uncomplete` - Mark todo as incomplete

**Business Rules:**
- Title is required and cannot be empty
- Title max 200 characters
- Description is optional, max 1000 characters
- Completed todos can still be edited
- Cannot mark non-existent todo as complete

**Validation:**
- Title: 1-200 characters, required
- Description: max 1000 characters, optional
- Completed: boolean

**Filters (GET /api/v1/todos):**
- `completed` - filter by completion status (true/false)
- `search` - search in title and description
- `sort_by` - field to sort by (created_at, updated_at, title)
- `sort_order` - asc or desc

**Pagination:**
- `page` - page number (default: 1)
- `page_size` - items per page (default: 20, max: 100)

## Error Handling

All errors return consistent JSON format:

```json
{
  "detail": "Human-readable error message",
  "error_code": "VALIDATION_ERROR",
  "field_errors": {
    "title": ["Title is required"]
  }
}
```

**HTTP Status Codes:**
- `200` - Success (GET, PUT, PATCH)
- `201` - Created (POST)
- `204` - No Content (DELETE)
- `400` - Bad Request (invalid data)
- `404` - Not Found (todo doesn't exist)
- `422` - Validation Error (Pydantic validation failures)
- `500` - Internal Server Error

## Pagination Format

All list endpoints return:

```json
{
  "items": [...],
  "total": 100,
  "page": 1,
  "page_size": 20,
  "total_pages": 5
}
```

## Database Schema

```sql
CREATE TABLE todos (
    id SERIAL PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    description TEXT,
    completed BOOLEAN DEFAULT false,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_todos_completed ON todos(completed);
CREATE INDEX idx_todos_created_at ON todos(created_at);
```

## API Documentation

FastAPI automatically generates OpenAPI documentation available at:
- `/docs` - Swagger UI (interactive API testing)
- `/redoc` - ReDoc (alternative documentation view)
- `/openapi.json` - OpenAPI schema JSON

## Testing Requirements

### Test Categories

1. **Endpoint Tests** - HTTP request/response validation
   - Test all CRUD operations
   - Verify status codes
   - Validate response schemas
   - Test error cases (400, 404, 422)

2. **Model Tests** - Database model behavior
   - Test model creation
   - Verify default values
   - Test constraints

3. **Business Logic Tests** - Service layer rules
   - Test validation
   - Verify business rules
   - Test edge cases

### Test Coverage Goals
- Overall coverage: >80%
- Critical paths (CRUD operations): 100%

## Success Criteria

### Functionality
- All CRUD operations work correctly
- Validation catches invalid input
- Filters and pagination function correctly
- Error handling is comprehensive

### Code Quality
- Clean, maintainable code structure
- Proper separation of concerns (models, schemas, services, routers)
- Type hints throughout
- No code duplication

### Testing
- All endpoints have test coverage
- Both happy path and error cases tested
- Tests run fast (<3 seconds for full suite)

### Documentation
- OpenAPI spec is accurate and complete
- All endpoints documented
- Request/response schemas clear

## Project Structure

```
project/
├── app/
│   ├── __init__.py
│   ├── main.py                 # FastAPI app
│   ├── config.py               # Settings
│   ├── database.py             # DB connection
│   ├── models/
│   │   ├── __init__.py
│   │   ├── base.py            # Base model
│   │   └── todo.py            # Todo model
│   ├── schemas/
│   │   ├── __init__.py
│   │   ├── todo.py            # Todo Pydantic models
│   │   └── common.py          # Pagination
│   ├── routers/
│   │   ├── __init__.py
│   │   └── v1/
│   │       ├── __init__.py
│   │       └── todos.py       # Todo endpoints
│   ├── services/
│   │   ├── __init__.py
│   │   └── todo_service.py    # Todo business logic
│   └── dependencies/
│       ├── __init__.py
│       ├── auth.py            # Mock auth
│       └── database.py        # DB session
├── tests/
│   ├── __init__.py
│   ├── conftest.py            # Pytest fixtures
│   └── api/
│       └── v1/
│           └── test_todos.py  # Todo endpoint tests
├── alembic/                   # Database migrations
│   ├── env.py
│   └── versions/
├── docker compose.yml
├── alembic.ini
├── pyproject.toml
├── .env.example
├── feature_list.json
├── init.sh
└── README.md
```

## Implementation Priority

Implement features in this order:

1. **Foundation** (Session 1)
   - Project structure
   - Database setup (PostgreSQL + Alembic)
   - Mock authentication
   - Base models and schemas

2. **Todos API** (Sessions 2-3)
   - Todo CRUD endpoints
   - Todo validation and business rules
   - Completion toggle endpoints
   - Todo tests

3. **Polish** (Session 4+)
   - Integration tests
   - Performance optimization
   - Documentation review
   - Error handling improvements

---

## User Workflows & Journeys

### Workflow 1: Create a Todo

**User Role:** User
**Goal:** Create a new todo item

**Steps:**
1. User opens todo app
2. Clicks "Add Todo" button
3. Fills in title (required)
4. Optionally adds description
5. Clicks "Save"
6. Todo appears in list with completed=false

**Success Criteria:** Todo is created and visible in the list

**Error Cases:**
- Missing title → Show validation error "Title is required"
- Title too long → Show error "Title must be 200 characters or less"

### Workflow 2: Complete a Todo

**User Role:** User
**Goal:** Mark a todo as complete

**Steps:**
1. User views todo list
2. Finds the todo to complete
3. Clicks checkbox next to todo
4. Todo is marked as completed (checkbox checked, possibly styled differently)

**Success Criteria:** Todo status changes to completed=true

### Workflow 3: View and Filter Todos

**User Role:** User
**Goal:** View all todos and filter by completion status

**Steps:**
1. User views todo list (shows all todos by default)
2. Clicks filter dropdown
3. Selects "Active" (incomplete todos only)
4. List updates to show only incomplete todos
5. Can switch to "Completed" to see finished todos
6. Can switch to "All" to see everything

**Success Criteria:** List correctly filters based on selection

### Workflow 4: Edit a Todo

**User Role:** User
**Goal:** Update an existing todo's title or description

**Steps:**
1. User clicks on a todo in the list
2. Todo detail view opens (or inline editing)
3. User edits title or description
4. Clicks "Save"
5. Todo is updated in the list

**Success Criteria:** Changes are saved and visible

**Error Cases:**
- Empty title → Show error "Title is required"

### Workflow 5: Delete a Todo

**User Role:** User
**Goal:** Remove a todo from the list

**Steps:**
1. User finds todo to delete
2. Clicks delete button (trash icon)
3. Optional: Confirmation dialog appears
4. User confirms deletion
5. Todo is removed from the list

**Success Criteria:** Todo is deleted and no longer appears

---

## Suggested Screen Structure

### Main Screen (Todo List)
**Purpose:** View all todos, filter, and quick actions

**Key Elements:**
- Header with "Todo List" title
- "Add Todo" button (prominent, top right)
- Filter tabs: All / Active / Completed
- Search bar (search title and description)
- Todo list (scrollable)
  - Each todo: checkbox, title, edit button, delete button
  - Completed todos: strikethrough text or different style
- Empty state: "No todos yet. Create your first todo!"

**Actions:**
- Click "Add Todo" → Open create form
- Click checkbox → Toggle completion
- Click todo title → View/edit detail
- Click delete → Delete todo (with confirmation)
- Use search → Filter results
- Use tabs → Filter by status

**Layout Pattern:** Single-page list view

### Add/Edit Todo Form (Modal or separate view)
**Purpose:** Create new todo or edit existing one

**Key Elements:**
- Title input field (required, max 200 chars)
- Description textarea (optional, max 1000 chars)
- Character counter (for title)
- Save button
- Cancel button

**Actions:**
- Fill form and save → Create/update todo
- Click cancel → Close form without saving

**Layout Pattern:** Modal or slide-in panel

---

## Feature Priority for Frontend

### Must Have (MVP)
- [ ] Create todo
- [ ] List all todos
- [ ] Mark todo as complete/incomplete (checkbox)
- [ ] Delete todo
- [ ] Edit todo title

### Should Have
- [ ] Edit todo description
- [ ] Filter by completion status (All/Active/Completed tabs)
- [ ] Search todos
- [ ] Empty state when no todos
- [ ] Error handling and validation messages
- [ ] Loading states

### Nice to Have
- [ ] Sort by created date, updated date, or title
- [ ] Bulk actions (delete all completed)
- [ ] Todo count ("5 items left")
- [ ] Keyboard shortcuts
- [ ] Drag and drop reordering
- [ ] Dark mode
- [ ] Animations (todo completion, delete)
